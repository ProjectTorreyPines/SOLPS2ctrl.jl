<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SOLPS2ctrl.jl · SOLPS2ctrl</title><meta name="title" content="SOLPS2ctrl.jl · SOLPS2ctrl"/><meta property="og:title" content="SOLPS2ctrl.jl · SOLPS2ctrl"/><meta property="twitter:title" content="SOLPS2ctrl.jl · SOLPS2ctrl"/><meta name="description" content="Documentation for SOLPS2ctrl."/><meta property="og:description" content="Documentation for SOLPS2ctrl."/><meta property="twitter:description" content="Documentation for SOLPS2ctrl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>SOLPS2ctrl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>SOLPS2ctrl.jl</a><ul class="internal"><li><a class="tocitem" href="#Documentation-of-other-repositories-in-this-project"><span>Documentation of other repositories in this project</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Top-file-handling-functions"><span>Top file handling functions</span></a></li><li><a class="tocitem" href="#Repairing/filling-out-partial-equilibrium-files"><span>Repairing/filling out partial equilibrium files</span></a></li><li><a class="tocitem" href="#Extrapolations"><span>Extrapolations</span></a></li><li><a class="tocitem" href="#System-identification-and-modeling"><span>System identification and modeling</span></a></li><li><a class="tocitem" href="#Unit-conversion-utilities"><span>Unit conversion utilities</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>SOLPS2ctrl.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SOLPS2ctrl.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="SOLPS2ctrl.jl"><a class="docs-heading-anchor" href="#SOLPS2ctrl.jl">SOLPS2ctrl.jl</a><a id="SOLPS2ctrl.jl-1"></a><a class="docs-heading-anchor-permalink" href="#SOLPS2ctrl.jl" title="Permalink"></a></h1><ul><li><a href="#SOLPS2ctrl.jl">SOLPS2ctrl.jl</a></li><li class="no-marker"><ul><li><a href="#Documentation-of-other-repositories-in-this-project">Documentation of other repositories in this project</a></li><li class="no-marker"><ul><li><a href="#[IMASggd.jl](https://projecttorreypines.github.io/IMASggd.jl/stable)">IMASggd.jl</a></li><li><a href="#[SOLPS2imas.jl](https://projecttorreypines.github.io/SOLPS2imas.jl/stable)">SOLPS2imas.jl</a></li><li><a href="#[FusionSyntheticDiagnostics.jl](https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable)">FusionSyntheticDiagnostics.jl</a></li></ul></li><li><a href="#Installation">Installation</a></li><li><a href="#Top-file-handling-functions">Top file handling functions</a></li><li><a href="#Repairing/filling-out-partial-equilibrium-files">Repairing/filling out partial equilibrium files</a></li><li><a href="#Extrapolations">Extrapolations</a></li><li class="no-marker"><ul><li><a href="#Core-profile-extrapolations">Core profile extrapolations</a></li><li><a href="#Edge-profiles-extrapolations">Edge profiles extrapolations</a></li></ul></li><li><a href="#System-identification-and-modeling">System identification and modeling</a></li><li><a href="#Unit-conversion-utilities">Unit conversion utilities</a></li></ul></li></ul><p>This repository serves as the top most workflow manager with helpful utilities to use other repositories in this project. Following steps are supported/planned in near future:</p><ul><li>Loading SOLPS outputs into IMAS data dictionary format</li><li>Loading equilibrium (that the SOLPS mesh was based on) into IMAS DD format</li><li>Extrapolating results into core and far SOL region if required</li><li>Running synthetic diagnostics on them</li><li>Performing system identification (to be added)</li><li>Designing and tuning linear causal and model predictive controllers (to be added)</li></ul><h2 id="Documentation-of-other-repositories-in-this-project"><a class="docs-heading-anchor" href="#Documentation-of-other-repositories-in-this-project">Documentation of other repositories in this project</a><a id="Documentation-of-other-repositories-in-this-project-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-of-other-repositories-in-this-project" title="Permalink"></a></h2><h3 id="[IMASggd.jl](https://projecttorreypines.github.io/IMASggd.jl/stable)"><a class="docs-heading-anchor" href="#[IMASggd.jl](https://projecttorreypines.github.io/IMASggd.jl/stable)"><a href="https://projecttorreypines.github.io/IMASggd.jl/stable">IMASggd.jl</a></a><a id="[IMASggd.jl](https://projecttorreypines.github.io/IMASggd.jl/stable)-1"></a><a class="docs-heading-anchor-permalink" href="#[IMASggd.jl](https://projecttorreypines.github.io/IMASggd.jl/stable)" title="Permalink"></a></h3><h3 id="[SOLPS2imas.jl](https://projecttorreypines.github.io/SOLPS2imas.jl/stable)"><a class="docs-heading-anchor" href="#[SOLPS2imas.jl](https://projecttorreypines.github.io/SOLPS2imas.jl/stable)"><a href="https://projecttorreypines.github.io/SOLPS2imas.jl/stable">SOLPS2imas.jl</a></a><a id="[SOLPS2imas.jl](https://projecttorreypines.github.io/SOLPS2imas.jl/stable)-1"></a><a class="docs-heading-anchor-permalink" href="#[SOLPS2imas.jl](https://projecttorreypines.github.io/SOLPS2imas.jl/stable)" title="Permalink"></a></h3><h3 id="[FusionSyntheticDiagnostics.jl](https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable)"><a class="docs-heading-anchor" href="#[FusionSyntheticDiagnostics.jl](https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable)"><a href="https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable">FusionSyntheticDiagnostics.jl</a></a><a id="[FusionSyntheticDiagnostics.jl](https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable)-1"></a><a class="docs-heading-anchor-permalink" href="#[FusionSyntheticDiagnostics.jl](https://projecttorreypines.github.io/FusionSyntheticDiagnostics.jl/stable)" title="Permalink"></a></h3><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="nohighlight hljs">using Pkg
Pkg.add(&quot;SOLPS2ctrl&quot;)</code></pre><h2 id="Top-file-handling-functions"><a class="docs-heading-anchor" href="#Top-file-handling-functions">Top file handling functions</a><a id="Top-file-handling-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Top-file-handling-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.find_files_in_allowed_folders" href="#SOLPS2ctrl.find_files_in_allowed_folders"><code>SOLPS2ctrl.find_files_in_allowed_folders</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">find_files_in_allowed_folders(
    input_dirs::String...;
    eqdsk_file::String,
    recursive::Bool=true,
)</code></pre><p>Searches a list of allowed folders for a set of filenames that will provide information about the SOLPS case. Returns a list of filenames with complete paths.</p><p>Example:</p><pre><code class="language-julia hljs">SOLPS2ctrl.find_files_in_allowed_folders(
    &quot;&lt;your samples folder&gt;/D3D_Ma_184833_03600&quot;;
    eqdsk_file=&quot;g184833.03600&quot;,
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/SOLPS2ctrl.jl#L15-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.geqdsk_to_imas!" href="#SOLPS2ctrl.geqdsk_to_imas!"><code>SOLPS2ctrl.geqdsk_to_imas!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">geqdsk_to_imas!(
    eqdsk_file::String,
    dd::IMAS.dd;
    set_time::Union{Nothing, Float64}=nothing,
    time_index::Int=1,
)</code></pre><p>Transfers the equilibrium reconstruction from an EFIT-style gEQDSK file into the IMAS DD structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/SOLPS2ctrl.jl#L68-L78">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.preparation" href="#SOLPS2ctrl.preparation"><code>SOLPS2ctrl.preparation</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">preparation(
    eqdsk_file::String,
    dirs::String...;
    core_method::String=&quot;simple&quot;,
    filename::String=&quot;sd_input_data&quot;,
    output_format::String=&quot;json&quot;,
    eqdsk_set_time::Union{Nothing, Float64}=nothing,
    eq_time_index::Int=1,
    allow_boundary_flux_correction::Bool=false,
)::IMAS.dd</code></pre><p>Gathers SOLPS and EFIT files and loads them into IMAS structure. Extrapolates profiles as needed to get a complete picture.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/SOLPS2ctrl.jl#L243-L257">source</a></section></article><h2 id="Repairing/filling-out-partial-equilibrium-files"><a class="docs-heading-anchor" href="#Repairing/filling-out-partial-equilibrium-files">Repairing/filling out partial equilibrium files</a><a id="Repairing/filling-out-partial-equilibrium-files-1"></a><a class="docs-heading-anchor-permalink" href="#Repairing/filling-out-partial-equilibrium-files" title="Permalink"></a></h2><p>Tools for repairing/filling out partial equilibrium files.</p><p>Some of the added fields may not be totally accurate, so it is recommended to use this tool mainly for test cases, as a utility. For a real equilibrium, problems should be fixed properly.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.add_rho_to_equilibrium!" href="#SOLPS2ctrl.add_rho_to_equilibrium!"><code>SOLPS2ctrl.add_rho_to_equilibrium!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function add_rho_to_equilibrium(dd:IMAS.dd)</code></pre><p>Adds equilibrium rho profile to the DD</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/repair_eq.jl#L58-L62">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.check_rho_1d" href="#SOLPS2ctrl.check_rho_1d"><code>SOLPS2ctrl.check_rho_1d</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">check_rho_1d(
    dd::IMAS.dd;
    time_slice::Int=1,
    throw_on_fail::Bool=false,
)::Bool</code></pre><p>Checks to see if rho exists and is valid in the equilibrium 1d profiles</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/repair_eq.jl#L15-L23">source</a></section></article><h2 id="Extrapolations"><a class="docs-heading-anchor" href="#Extrapolations">Extrapolations</a><a id="Extrapolations-1"></a><a class="docs-heading-anchor-permalink" href="#Extrapolations" title="Permalink"></a></h2><p>Utilities for extrapolating profiles</p><h3 id="Core-profile-extrapolations"><a class="docs-heading-anchor" href="#Core-profile-extrapolations">Core profile extrapolations</a><a id="Core-profile-extrapolations-1"></a><a class="docs-heading-anchor-permalink" href="#Core-profile-extrapolations" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.extrapolate_core" href="#SOLPS2ctrl.extrapolate_core"><code>SOLPS2ctrl.extrapolate_core</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">extrapolate_core(
    edge_rho::Vector{Float64},
    edge_quantity::Vector{Float64},
    rho_output::Vector{Float64},
)::Vector{Float64}</code></pre><p>Function for assuming a core profile when given edge profile data.</p><p>Concept:</p><ol><li>value and derivative should be continuous when joining real data</li><li>derivative at magnetic axis is known to be 0 when making profile vs. rho, by the definition of rho</li><li>derivative probably does something fancier between the pedestal and axis than just linear interpolation, so add an extra point in there</li><li>there&#39;s a joint between the steep pedestal and the shallow core that needs an extra knot to manage it properly</li><li>after making up a very simple gradient profile out of a few line segments, integrate it to get the profile of the quantity in question</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/supersize_profile.jl#L42-L62">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.fill_in_extrapolated_core_profile!" href="#SOLPS2ctrl.fill_in_extrapolated_core_profile!"><code>SOLPS2ctrl.fill_in_extrapolated_core_profile!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fill_in_extrapolated_core_profile!(
    dd::IMAS.dd,
    quantity_name::String;
    method::String=&quot;simple&quot;,
    eq_time_idx::Int=1,
    eq_profiles_2d_idx::Int=1,
    value_field::Symbol=:values,
    grid_ggd_idx::Int=1,
    cell_subset_idx::Int=5,
)</code></pre><p>This function accepts a DD that should be populated with <code>equilibrium</code> and <code>edge_profiles</code> as well as a request for a quantity to extrapolate into the core. It then maps <code>edge_profiles</code> data to rho, calls the function that performs the extrapolation (which is not a simple linear extrapolation but has some trickery to attempt to make a somewhat convincing profile shape), and writes the result to core_profiles. This involves a bunch of interpolations and stuff.</p><p>Input arguments:</p><ul><li><code>dd</code>: an IMAS data dictionary</li><li><code>quantity_name</code>: the name of a quantity in <code>edge_profiles.profiles_2d</code> and <code>core_profiles.profiles_1d</code>, such as &quot;electrons.density&quot;</li><li><code>method</code>: Extrapolation method.</li><li><code>eq_time_id</code>x: index of the equilibrium time slice to use. For a typical SOLPS run, the SOLPS mesh will be based on the equilibrium reconstruction at a single time, so the DD associated with the SOLPS run only needs one equilibrium time slice to be loaded. However, one could combine the complete equilibrium time series with the SOLPS run and then have to specify which slice of the equilibrium corresponds to the SOLPS mesh.</li><li><code>eq_profiles_2d_idx</code>: index of the <code>profiles_2D</code> in equilibrium <code>time_slice</code>.</li><li><code>value_field</code>: Symbolic name of the values field in quantity.</li><li><code>grid_ggd_idx</code>: index of the <code>grid_ggd</code> to use. For a typical SOLPS run, the SOLPS grid is fixed, so this index defaults to 1. But in future, if a time varying grid is used, then this index will need to be specified.</li><li><code>cell_subset_idx</code>: index of the subset of cells to use for the extrapolation. The default is 5, which is the subset of all cells. If <code>edge_profiles</code> data is instead present for a different subset, for instance, -5, which are b2.5 cells only, then this index should be set to -5.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/supersize_profile.jl#L105-L145">source</a></section></article><h3 id="Edge-profiles-extrapolations"><a class="docs-heading-anchor" href="#Edge-profiles-extrapolations">Edge profiles extrapolations</a><a id="Edge-profiles-extrapolations-1"></a><a class="docs-heading-anchor-permalink" href="#Edge-profiles-extrapolations" title="Permalink"></a></h3><p>These functions have not been fully tested and/or supported yet.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.mesh_psi_spacing" href="#SOLPS2ctrl.mesh_psi_spacing"><code>SOLPS2ctrl.mesh_psi_spacing</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mesh_psi_spacing(
    dd::IMAS.dd;
    eq_time_idx::Int=1,
    eq_profiles_2d_idx::Int=1,
    grid_ggd_idx::Int=1,
    space_idx::Int=1,
    avoid_guard_cell::Bool=true,
    spacing_rule=&quot;mean&quot;,
)</code></pre><p>Inspects the mesh to see how far apart faces are in psi_N. Requires that GGD and equilibrium are populated.</p><p>Input Arguments:</p><ul><li><code>dd</code>: a data dictionary instance with required data loaded into it</li><li><code>eq_time_idx</code>: index of the equilibrium time slice to use. For a typical SOLPS run, the SOLPS mesh will be based on the equilibrium reconstruction at a single time, so the DD associated with the SOLPS run only needs one equilibrium time slice to be loaded. However, one could combine the complete equilibrium time series with the SOLPS run and then have to specify which slice of the equilibrium corresponds to the SOLPS mesh.</li><li><code>eq_profiles_2d_id</code>x: index of the <code>profiles_2D</code> in equilibrium <code>time_slice</code>.</li><li><code>grid_ggd_idx</code>: index of the <code>grid_ggd</code> to use. For a typical SOLPS run, the SOLPS grid is fixed, so this index defaults to 1. But in future, if a time varying grid is used, then this index will need to be specified.</li><li><code>space_idx</code>: index of the space to use. For a typical SOLPS run, there will be only one space so this index will mostly remain at 1.</li><li><code>avoid_guard_cell</code>: assume that the last cell is a guard cell so take <code>end-2</code> and <code>end-1</code> instead of <code>end</code> and <code>end-1</code></li><li><code>spacing_rule</code>: &quot;edge&quot; or &quot;mean&quot; to make spacing of new cells (in <code>psi_N</code>) be the same as the spacing at the edge of the mesh, or the same as the average spacing</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/supersize_profile.jl#L331-L364">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.cached_mesh_extension!" href="#SOLPS2ctrl.cached_mesh_extension!"><code>SOLPS2ctrl.cached_mesh_extension!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">cached_mesh_extension!(
    dd::IMAS.dd,
    eqdsk_file::String,
    b2fgmtry::String;
    eq_time_idx::Int=1,
    eq_profiles_2d_idx::Int=1,
    grid_ggd_idx::Int=1,
    space_idx::Int=1,
    clear_cache::Bool=false,
)::String</code></pre><p>Adds an extended mesh to a data dictionary, possibly from a cached result.</p><p>Input Arguments:</p><ul><li><code>dd</code>: The data dictionary. It will be modified in place.</li><li><code>eqdsk_file</code>: the name of the EQDSK file that was used to get equilibrium data in the dd.</li><li><code>b2fgmtry</code>: the name of the SOLPS geometry file that was used to get GGD info in <code>edge_profiles</code> in the dd.</li><li><code>eq_time_idx</code>: Index of the time slice in equilibrium</li><li><code>eq_profiles_2d_idx</code>: Index of the 2D profile set in equilibrium (there is usually only one)</li><li><code>grid_ggd_idx</code>: Index of the <code>grid_ggd</code> set in edge_profiles</li><li><code>space_idx</code>: Index of the space</li><li><code>clear_cache</code>: delete any existing cache file (for use in testing)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/supersize_profile.jl#L893-L920">source</a></section></article><h2 id="System-identification-and-modeling"><a class="docs-heading-anchor" href="#System-identification-and-modeling">System identification and modeling</a><a id="System-identification-and-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#System-identification-and-modeling" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.offset_scale" href="#SOLPS2ctrl.offset_scale"><code>SOLPS2ctrl.offset_scale</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">offset_scale(
    val::Union{Float64, Vector{Float64}, Matrix{Float64}};
    offset::Union{Float64, Vector{Float64}}=0.0,
    factor::Union{Float64, Vector{Float64}}=1.0,
)::typeof(val)</code></pre><p>Subtract an <code>offset</code> and multiply by a <code>factor</code>, the <code>val</code> to make it nominally in the range of -1 to 1 (not strictly) for easy identification of system.</p><pre><code class="nohighlight hljs">(val .- offset) .* factor</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/system_id.jl#L8-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.unscale_unoffset" href="#SOLPS2ctrl.unscale_unoffset"><code>SOLPS2ctrl.unscale_unoffset</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">unscale_unoffset(
    offset_scaled::Union{Float64, Vector{Float64}, Matrix{Float64}};
    offset::Union{Float64, Vector{Float64}}=0.0,
    factor::Union{Float64, Vector{Float64}}=1.0,
)::typeof(offset_scaled)</code></pre><p>Undo previously applied offset and scaling.</p><pre><code class="nohighlight hljs">offset_scaled ./ factor .+ offset</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/system_id.jl#L28-L38">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.system_id" href="#SOLPS2ctrl.system_id"><code>SOLPS2ctrl.system_id</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">system_id(
    inp::Union{Vector{Float64}, Matrix{Float64}},
    out::Union{Vector{Float64}, Matrix{Float64}},
    tt::Vector{Float64},
    order::Int;
    input_cond::Union{Nothing, Function}=nothing,
    inp_offset::Float64=0.0, inp_factor::Float64=1.0,
    out_offset::Float64=0.0, out_factor::Float64=1.0,
    input_cond_kwargs::Dict{Symbol, T}=Dict{Symbol, Any}(),
    newpem_kwargs::Dict{Symbol, U}=Dict{Symbol, Any}(),
    verbose::Bool=false,
) where {T, U}</code></pre><p>Perform system identification for a set on input data <code>inp</code>, output data <code>out</code>, and time series vector <code>tt</code>. If there are more than one inputs or outputs, provide them as Matrix with first dimension for ports (input or output) and second dimension for time. If <code>input_cond</code> is provided, it is applied to offseted and scaled input before performing system identification with keywords for this function provided in <code>input_cond_kwargs</code>.</p><p>This function uses <a href="https://baggepinnen.github.io/ControlSystemIdentification.jl/stable/ss/#ControlSystemIdentification.newpem">ControlSystemIdentification.newpem</a> to perform the system identification. Any additional keywords for this function should be passed as dictionary in <code>newpem_kwargs</code>. For advanced use, it is recommended to do system identification directly with <code>newpem</code> instead of using this function.</p><p>Returns a linear state space model of the <code>order</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/system_id.jl#L47-L74">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.system_id_optimal_input_cond" href="#SOLPS2ctrl.system_id_optimal_input_cond"><code>SOLPS2ctrl.system_id_optimal_input_cond</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">system_id_optimal_input_cond(
    inp::Union{Vector{Float64}, Matrix{Float64}},
    out::Union{Vector{Float64}, Matrix{Float64}},
    tt::Vector{Float64},
    order::Int,
    input_cond::Union{Nothing, Function},
    input_cond_args_guess::Dict{Symbol, T};
    inp_offset::Float64=0.0, inp_factor::Float64=1.0,
    out_offset::Float64=0.0, out_factor::Float64=1.0,
    input_cond_args_lower::Dict{Symbol, V}=Dict{Symbol, Any}(),
    input_cond_args_upper::Dict{Symbol, W}=Dict{Symbol, Any}(),
    newpem_kwargs::Dict{Symbol, U}=Dict{Symbol, Any}(),
    verbose::Bool=false,
) where {T, U, V, W}</code></pre><p>Perform system identification for a set on input data <code>inp</code>, output data <code>out</code>, and time series vector <code>tt</code>. If there are more than one inputs or outputs, provide them as Matrix with first dimension for ports (input or output) and second dimension for time.</p><p>The <code>input_cond</code> is applied to offseted and scaled input before performing system identification. The <code>input_cond_args_guess</code> is used as initial keyword arguments that provide the parameters of the <code>input_cond</code>. These arguments are then used to find the best fit while iteratively performing <a href="#SOLPS2ctrl.system_id"><code>system_id</code></a> in each step.</p><p>This function uses <a href="https://baggepinnen.github.io/ControlSystemIdentification.jl/stable/ss/#ControlSystemIdentification.newpem">ControlSystemIdentification.newpem</a> to perform the system identification. Any additional keywords for this function should be passed as dictionary in <code>newpem_kwargs</code>.</p><p>This function uses <a href="https://julianlsolvers.github.io/LsqFit.jl/latest/api/#LsqFit.curve_fit">LsqFit.curve_fit</a> to fit the parameters of input conditions along with performing the system identification.</p><p>For advanced use, it is recommended to do system identification directly with <code>newpem</code> and optimize using your favorite fitting method instead of using this function.</p><p>Returns a linear state space model of the <code>order</code> and the keyword argument dictionary containing optimal parameters for <code>input_cond</code> function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/system_id.jl#L171-L209">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.model_evolve" href="#SOLPS2ctrl.model_evolve"><code>SOLPS2ctrl.model_evolve</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">model_evolve(
    sys::Union{PredictionStateSpace, StateSpace},
    inp::Union{Vector{Float64}, Matrix{Float64}};
    input_cond::Union{Nothing, Function}=nothing,
    inp_offset::Float64=0.0, inp_factor::Float64=1.0,
    out_offset::Float64=0.0, out_factor::Float64=1.0,
    input_cond_kwargs::Dict{Symbol, T}=Dict{Symbol, Any}(),
)::Union{Vector{Float64}, Matrix{Float64}} where {T}</code></pre><p>Evolve a state space model <code>sys</code> with the input steps <code>inp</code>. The input is offseted and scaled with <code>inp_offset</code> and <code>inp_factor</code> and the output is unscaled and unoffseted with <code>out_offset</code> and <code>out_factor</code>. If a function is provided as <code>inp_cond</code> it is applied to the input after scaling and offseting along with any keywords passed for it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/system_id.jl#L127-L141">source</a></section></article><h2 id="Unit-conversion-utilities"><a class="docs-heading-anchor" href="#Unit-conversion-utilities">Unit conversion utilities</a><a id="Unit-conversion-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-conversion-utilities" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SOLPS2ctrl.gas_unit_converter" href="#SOLPS2ctrl.gas_unit_converter"><code>SOLPS2ctrl.gas_unit_converter</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gas_unit_converter(
    value_in::Float64,
    units_in::String,
    units_out::String;
    species::String=&quot;H&quot;,
    temperature::Float64=293.15,
)</code></pre><p>Converts gas flows between different units. Uses ideal gas law to convert between Pressure * volume type flows / quantities and count / current types of units. There is a version that accepts floats in and outputs floats, and another that deals in Unitful quantities.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/unit_utils.jl#L28-L41">source</a></section><section><div><pre><code class="language-julia hljs">gas_unit_converter(
    value_in::Unitful.Quantity,
    units_in::String,
    units_out::String;
    species::String=&quot;H&quot;,
    temperature=293.15 * Unitful.K,
)</code></pre><p>Converts gas flows between different units. Uses ideal gas law to convert between Pressure * volume type flows / quantities and count / current types of units. This is the Unitful version.</p><p>Output will be unitful, but the units are not simplified automatically. You can perform operations such as</p><ul><li><code>(output |&gt; Unitful.upreferred).val</code></li><li><code>Unitful.uconvert(Unitful.whatever, output).val</code></li></ul><p>to handle simplification or conversion of units.</p><p>Although this function pretends torr L s<span>$^{-1}$</span> and Pa m<span>$^3$</span> s<span>$^{-1}$</span> are different, use of Unitful should cause them to behave the same way as long as you simplify or convert units at the end. This means that you can use other pressure*volume type gas units and call them torr L s<span>$^{-1}$</span> and the script will deal with them up to having messy units in the output.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ProjectTorreyPines/SOLPS2ctrl.jl/blob/364fe1ff09ee2f89d9f3b818f8742ca202f4162b/src/unit_utils.jl#L85-L111">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Friday 13 June 2025 18:36">Friday 13 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
